blueprint:
  name: Bambu Lab Zigbee RGB Light Controller
  description: Control one or more Zigbee RGB lights with Bambu 3d printer
  domain: automation
  input:
    printer_status:
      name: Print Status of your Bambu Lab printer
      description: "Select the print status entity."
      selector:
        entity:
          filter:
            domain: sensor
            integration: bambu_lab
    current_stage:
      name: Current Stage of your Bambu Lab Printer
      description: "Select the printer current stage entity."
      selector:
        entity:
          filter:
            domain: sensor
            integration: bambu_lab
    chamber_light:
      name: Chamber Light of your Bambu Lab Printer
      description: "Select the printer chamber light entity."
      selector:
        entity:
          filter:
            domain: light
            integration: bambu_lab
    zha_lights:
      name: Zigbee RGB Light devices
      description: "Select the Zigbee RGB light devices you wish to control."
      selector:
        device:
          filter:
            integration: zha
          multiple: true

alias Bambu Lab Light Controller
description: "Control one of more Zigbee RGB Lights with Bambu 3D Printer"
trigger:
  - platform: state
    entity_id:
      - !input chamber_light
      - !input printer_status
      - !input current_stage
    alias: When current stage, printer status or chamber light state changes
condition: []
action:
  - if
    - condition: state
      state: "on"
      alias: chamber light is on
      entity_id: !input chamber_light
    - condition: not
      conditions:
          - condition: state
            entity_id: !input current_stage
            state: scanning_bed_surface
            alias: Scanning Bed Surface
          - condition: state
            entity_id: !input current_stage
            state: cleaning_nozzle_tip
            alias: Cleaning Nozzle Tip
          - condition: state
            entity_id: !input current_stage
            state: calibrating_extrusion
            alias: Calibrating Extrusion
          - condition: state
            entity_id: !input current_stage
            state: calibrating_extrusion_flow
            alias: Calibrating Extrusion Flow
          - condition: state
            entity_id: !input current_stage
            state: offline
            alias: Printer is offline
          - condition: state
            entity_id: !input printer_status
            state: offline
            alias: Printer is offline
          - condition: state
            entity_id: !input current_stage
            state: calibrating_micro_lidar
            alias: Calibrating Micro Lidar